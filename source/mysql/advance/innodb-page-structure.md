---
title: InnoDB 数据页结构
---
# InnoDB 数据页结构
InnoDB 管理存储空间的基本单位是**页**，一个页的大小一般是 `16KB`。InnoDB 设计了多种不同类型的页，比如存放表空间头部信息的页，存放 Insert Buffer 信息的页等等。
我们聚焦的是那些存放我们表中记录的那种类型的页，官方称这种存放记录的页为**索引（`INDEX`）页**。我们暂叫做**数据页**吧。

## 数据页结构
一个 InnoDB 数据页的存储空间大致被划分成了 7 个部分：

| 名称 | 中文名 | 占用空间 | 简单描述 |
| --- | --- | --- | --- |
| `File Header` | 文件头部 | 38 字节 | 页的一些通用信息 |
| `Page Header` | 页面头部 | 56 字节 | 数据页专有的一些信息 |
| `Infimum + Supremum` | 最小记录和最大记录 | 26 字节 | 两个虚拟的行记录 |
| `User Records` | 用户记录 | 8 字节 | 实际存储的行记录内容 |
| `Free Space` | 空闲空间 | 不确定 | 页中尚未使用的空间 |
| `Page Directory` | 页面目录 | 不确定 | 页中的某些记录的相对位置 |
| `File Trailer` | 文件尾部 | 8 字节 | 校验页是否完整 |

## 记录在页中的存储
我们自己存储的记录会按照我们指定的行格式存储到 `User Records` 部分。但是在一开始生成页的时候，其实并没有 `User Records` 这个部分，每当我们插入一条记录，
都会从 `Free Space` 部分，也就是尚未使用的存储空间中申请一个记录大小的空间划分到 `User Records` 部分，当 `Free Space` 部分的空间全部被 `User Records` 部分
替代掉之后，也就意味着这个页使用完了，如果还有新的记录插入的话，就需要去申请新的页了。

为了更好的管理在 User Records 中的这些记录，InnoDB 可费了一番力气，还得从记录行格式的**记录头信息**中说起。

### 记录头信息的秘密
以 `compact` 格式为例：
#### `delete_mask`

这个属性标记着当前记录是否被删除，占用 `1` 个二进制位，为 1 的时候代表记录被删除掉了。

被删除的记录还在页中么？

是的，你以为它删除了，可它还在真实的磁盘上。这些被删除的记录之所以不立即从磁盘上移除，是因为移除它们之后把其他的记录在磁盘上重新排列需要性能消耗，
所以只是打一个删除标记而已，所有被删除掉的记录都会组成一个所谓的**垃圾链表**，在这个链表中的记录占用的空间称之为所谓的**可重用空间**，之后如果有新记录插入到表中的话，
可能把这些被删除的记录占用的存储空间覆盖掉。

#### `next_record`
