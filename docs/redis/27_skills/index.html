<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="一些命令行技巧#直接模式#一般使用 redis-cli 都会进入交互模式，然后一问一答来读写服务器，这是交互模式。还有一种直接模式，通过将命令参数直接 传递给 redis-cli 来执行指令并获取输出结果。
$ redis-cli incrby foo 5 (integer) 5 # 输出的内容较大，可以将输出重定向到外部文件 $ redis-cli info &gt; info.txt $ wc -l info.txt 120 info.txt # 如果想指向特定的服务器 # -n 2 表示使用第 2 个库，相当于 select 2 $ redis-cli -h localhost -p 6379 -n 2 ping PONG 批量执行命令#$ cat cmds.txt set foo1 bar1 set foo2 bar2 set foo3 bar3 ...... $ cat cmds.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="一些命令行技巧" />
<meta property="og:description" content="一些命令行技巧#直接模式#一般使用 redis-cli 都会进入交互模式，然后一问一答来读写服务器，这是交互模式。还有一种直接模式，通过将命令参数直接 传递给 redis-cli 来执行指令并获取输出结果。
$ redis-cli incrby foo 5 (integer) 5 # 输出的内容较大，可以将输出重定向到外部文件 $ redis-cli info &gt; info.txt $ wc -l info.txt 120 info.txt # 如果想指向特定的服务器 # -n 2 表示使用第 2 个库，相当于 select 2 $ redis-cli -h localhost -p 6379 -n 2 ping PONG 批量执行命令#$ cat cmds.txt set foo1 bar1 set foo2 bar2 set foo3 bar3 ...... $ cat cmds." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://shipengqi.github.io/db-learn/docs/redis/27_skills/" />
<meta property="article:modified_time" content="2020-06-17T17:45:14+08:00" />
<title>一些命令行技巧 | Database Learning</title>
<link rel="manifest" href="/db-learn/manifest.json">
<link rel="icon" href="/db-learn/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/db-learn/book.min.b3215d9d1d18d9051e7fbe8f256ff80e30f41d29073b86348e230d297b771002.css" integrity="sha256-syFdnR0Y2QUef76PJW/4DjD0HSkHO4Y0jiMNKXt3EAI=">
<script defer src="/db-learn/en.search.min.79aa4caec43110b70bc10866de8e262ae56a148e0d75708b1522265755d59b70.js" integrity="sha256-eapMrsQxELcLwQhm3o4mKuVqFI4NdXCLFSImV1XVm3A="></script>

<script defer src="/db-learn/sw.min.b93542a5760842e2e25439dfb3c014a53a75c12fc8ef2e8e01a71b378f98e127.js" integrity="sha256-uTVCpXYIQuLiVDnfs8AUpTp1wS/I7y6OAacbN4&#43;Y4Sc="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/db-learn"><span>Database Learning</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>






  
<ul>
  
  <li>
    <a href="https://github.com/shipengqi/db-learn" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://shipengqi.github.io/" target="_blank" rel="noopener">
        Blog
      </a>
  </li>
  
</ul>







  <p>━━━━━━━━━━━━━━━━━━━</p>
<ul>
<li>
<p><strong>Mysql</strong></p>
<ul>
<li>
  <a href="/db-learn/docs/mysql/01_getting_started/">入门</a></li>
<li>
  <a href="/db-learn/docs/mysql/02_install/">安裝</a></li>
<li>
  <a href="/db-learn/docs/mysql/03_query/">简单查询</a></li>
<li>
  <a href="/db-learn/docs/mysql/04_advanced_query/">复杂查询</a></li>
<li>
  <a href="/db-learn/docs/mysql/05_write_operation/">写操作</a></li>
<li>
  <a href="/db-learn/docs/mysql/06_other/">其他</a></li>
<li>
  <a href="/db-learn/docs/mysql/07_architecture/">基础架构</a></li>
<li>
  <a href="/db-learn/docs/mysql/08_config/">启动选项和配置文件</a></li>
<li>
  <a href="/db-learn/docs/mysql/09_character/">字符集和比较规则</a></li>
<li>
  <a href="/db-learn/docs/mysql/10_innodb-record-store-structure/">InnoDB 记录存储结构</a></li>
<li>
  <a href="/db-learn/docs/mysql/11_innodb-page-structure/">InnoDB 数据页结构</a></li>
<li>
  <a href="/db-learn/docs/mysql/12_b-tree/">B+ 树索引</a></li>
<li>
  <a href="/db-learn/docs/mysql/13_isolation-level/">事务的隔离级别</a></li>
<li>
  <a href="/db-learn/docs/mysql/14_lock/">锁</a>
<!-- raw HTML omitted --></li>
</ul>
</li>
<li>
<p><strong>Redis</strong></p>
<ul>
<li>
  <a href="/db-learn/docs/redis/01_getting-started/">入门</a></li>
<li>
  <a href="/db-learn/docs/redis/02_redis-config/">安装配置</a></li>
<li>
  <a href="/db-learn/docs/redis/03_redis-string/">数据类型 String</a></li>
<li>
  <a href="/db-learn/docs/redis/04_redis-hash/">数据类型 Hash</a></li>
<li>
  <a href="/db-learn/docs/redis/05_redis-set/">数据类型 Set</a></li>
<li>
  <a href="/db-learn/docs/redis/06_redis-sortedset/">数据类型 SortedSet</a></li>
<li>
  <a href="/db-learn/docs/redis/07_redis-list/">数据类型 List</a></li>
<li>
  <a href="/db-learn/docs/redis/08_redis-key/">Key 操作</a></li>
<li>
  <a href="/db-learn/docs/redis/09_sds/">简单动态字符串</a></li>
<li>
  <a href="/db-learn/docs/redis/10_dict/">字典</a></li>
<li>
  <a href="/db-learn/docs/redis/11_redis-object/">对象</a></li>
<li>
  <a href="/db-learn/docs/redis/12_bitmap/">位图</a></li>
<li>
  <a href="/db-learn/docs/redis/13_distributed-lock/">分布式锁</a></li>
<li>
  <a href="/db-learn/docs/redis/14_queue/">延时队列</a></li>
<li>
  <a href="/db-learn/docs/redis/15_hyperloglog/">HyperLogLog</a></li>
<li>
  <a href="/db-learn/docs/redis/16_bloom-filter/">布隆过滤器</a></li>
<li>
  <a href="/db-learn/docs/redis/17_current-limit/">限流</a></li>
<li>
  <a href="/db-learn/docs/redis/18_geohash/">GeoHash</a></li>
<li>
  <a href="/db-learn/docs/redis/19_persistence/">持久化</a></li>
<li>
  <a href="/db-learn/docs/redis/20_pipeline/">管道</a></li>
<li>
  <a href="/db-learn/docs/redis/21_transaction/">事务</a></li>
<li>
  <a href="/db-learn/docs/redis/22_sync/">主从同步</a></li>
<li>
  <a href="/db-learn/docs/redis/23_cluster/">集群</a></li>
<li>
  <a href="/db-learn/docs/redis/24_info/">INFO 指令</a></li>
<li>
  <a href="/db-learn/docs/redis/25_redis-expire-strategy/">过期策略和内存淘汰机制</a></li>
<li>
  <a href="/db-learn/docs/redis/26_protect-redis/">保护 Redis</a></li>
<li>
  <a href="/db-learn/docs/redis/27_skills/"class=active>一些命令行技巧</a></li>
<li>
  <a href="/db-learn/docs/redis/28_slowlog/">慢查询日志</a>
<!-- raw HTML omitted --></li>
</ul>
</li>
<li>
<p><strong>MongoDB</strong></p>
<ul>
<li>
  <a href="/db-learn/docs/mongo/01_overview/">介绍</a></li>
<li>
  <a href="/db-learn/docs/mongo/02_getting-started/">入门</a></li>
<li>
  <a href="/db-learn/docs/mongo/03_advance/">使用</a></li>
<li>
  <a href="/db-learn/docs/mongo/04_migrate/">数据迁移</a>
<!-- raw HTML omitted --></li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/db-learn/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>一些命令行技巧</strong>

  <label for="toc-control">
    
    <img src="/db-learn/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#直接模式">直接模式</a></li>
    <li><a href="#批量执行命令">批量执行命令</a></li>
    <li><a href="#set-多行字符串">set 多行字符串</a></li>
    <li><a href="#重复执行指令">重复执行指令</a></li>
    <li><a href="#监控服务器状态">监控服务器状态</a></li>
    <li><a href="#扫描大-key">扫描大 KEY</a></li>
    <li><a href="#采样服务器指令">采样服务器指令</a></li>
    <li><a href="#诊断服务器时延">诊断服务器时延</a></li>
    <li><a href="#远程-rdb-备份">远程 rdb 备份</a></li>
    <li><a href="#模拟从库">模拟从库</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="一些命令行技巧">
  一些命令行技巧
  <a class="anchor" href="#%e4%b8%80%e4%ba%9b%e5%91%bd%e4%bb%a4%e8%a1%8c%e6%8a%80%e5%b7%a7">#</a>
</h1>
<h2 id="直接模式">
  直接模式
  <a class="anchor" href="#%e7%9b%b4%e6%8e%a5%e6%a8%a1%e5%bc%8f">#</a>
</h2>
<p>一般使用 redis-cli 都会进入交互模式，然后一问一答来读写服务器，这是<strong>交互模式</strong>。还有一种<strong>直接模式</strong>，通过将命令参数直接
传递给 redis-cli 来执行指令并获取输出结果。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ redis-cli incrby foo <span style="color:#ae81ff">5</span>
<span style="color:#f92672">(</span>integer<span style="color:#f92672">)</span> <span style="color:#ae81ff">5</span>

<span style="color:#75715e"># 输出的内容较大，可以将输出重定向到外部文件</span>
$ redis-cli info &gt; info.txt
$ wc -l info.txt
     <span style="color:#ae81ff">120</span> info.txt

<span style="color:#75715e"># 如果想指向特定的服务器</span>
<span style="color:#75715e"># -n 2 表示使用第 2 个库，相当于 select 2</span>
$ redis-cli -h localhost -p <span style="color:#ae81ff">6379</span> -n <span style="color:#ae81ff">2</span> ping
PONG
</code></pre></div><h2 id="批量执行命令">
  批量执行命令
  <a class="anchor" href="#%e6%89%b9%e9%87%8f%e6%89%a7%e8%a1%8c%e5%91%bd%e4%bb%a4">#</a>
</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cat cmds.txt
set foo1 bar1
set foo2 bar2
set foo3 bar3
......
$ cat cmds.txt | redis-cli
OK
OK
OK
...

<span style="color:#75715e"># 或者</span>
$ redis-cli &lt; cmds.txt
OK
OK
OK
...
</code></pre></div><h2 id="set-多行字符串">
  set 多行字符串
  <a class="anchor" href="#set-%e5%a4%9a%e8%a1%8c%e5%ad%97%e7%ac%a6%e4%b8%b2">#</a>
</h2>
<p>如果一个字符串有多行，如何传入 set 指令？使用 <code>-x</code> 选项，该选项会使用标准输入的内容作为最后一个参数。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cat str.txt
Ernest Hemingway once wrote,
<span style="color:#e6db74">&#34;The world is a fine place and worth fighting for.&#34;</span>
I agree with the second part.
$ redis-cli -x set foo &lt; str.txt
OK
$ redis-cli get foo
<span style="color:#e6db74">&#34;Ernest Hemingway once wrote,\n\&#34;The world is a fine place and worth fighting for.\&#34;\nI agree with the second part.\n&#34;</span>
</code></pre></div><h2 id="重复执行指令">
  重复执行指令
  <a class="anchor" href="#%e9%87%8d%e5%a4%8d%e6%89%a7%e8%a1%8c%e6%8c%87%e4%bb%a4">#</a>
</h2>
<p>redis-cli 还支持重复执行指令多次，每条指令执行之间设置一个间隔时间，如此便可以观察某条指令的输出内容随时间变化。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">// 间隔 1s，执行 <span style="color:#ae81ff">5</span> 次，观察 qps 的变化
$ redis-cli -r <span style="color:#ae81ff">5</span> -i <span style="color:#ae81ff">1</span> info | grep ops
instantaneous_ops_per_sec:43469
instantaneous_ops_per_sec:47460
instantaneous_ops_per_sec:47699
instantaneous_ops_per_sec:46434
instantaneous_ops_per_sec:47216
</code></pre></div><p>如果将次数设置为 <code>-1</code> 那就是重复无数次永远执行下去。如果不提供 <code>-i</code> 参数，那就没有间隔，连续重复执行。</p>
<p>在交互模式下也可以重复执行指令，形式上比较怪异，在指令前面增加次数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">127.0.0.1:6379&gt; <span style="color:#ae81ff">5</span> ping
PONG
PONG
PONG
PONG
PONG
</code></pre></div><h2 id="监控服务器状态">
  监控服务器状态
  <a class="anchor" href="#%e7%9b%91%e6%8e%a7%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%8a%b6%e6%80%81">#</a>
</h2>
<p>可以使用 <code>--stat</code> 参数来实时监控服务器的状态，间隔 1s 实时输出一次。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ redis-cli --stat
------- data ------ --------------------- load -------------------- - child -
keys       mem      clients blocked requests            connections
<span style="color:#ae81ff">2</span>          6.66M    <span style="color:#ae81ff">100</span>     <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">11591628</span> <span style="color:#f92672">(</span>+0<span style="color:#f92672">)</span>       <span style="color:#ae81ff">335</span>
<span style="color:#ae81ff">2</span>          6.66M    <span style="color:#ae81ff">100</span>     <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">11653169</span> <span style="color:#f92672">(</span>+61541<span style="color:#f92672">)</span>   <span style="color:#ae81ff">335</span>
<span style="color:#ae81ff">2</span>          6.66M    <span style="color:#ae81ff">100</span>     <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">11706550</span> <span style="color:#f92672">(</span>+53381<span style="color:#f92672">)</span>   <span style="color:#ae81ff">335</span>
<span style="color:#ae81ff">2</span>          6.54M    <span style="color:#ae81ff">100</span>     <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">11758831</span> <span style="color:#f92672">(</span>+52281<span style="color:#f92672">)</span>   <span style="color:#ae81ff">335</span>
<span style="color:#ae81ff">2</span>          6.66M    <span style="color:#ae81ff">100</span>     <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">11803132</span> <span style="color:#f92672">(</span>+44301<span style="color:#f92672">)</span>   <span style="color:#ae81ff">335</span>
<span style="color:#ae81ff">2</span>          6.66M    <span style="color:#ae81ff">100</span>     <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">11854183</span> <span style="color:#f92672">(</span>+51051<span style="color:#f92672">)</span>   <span style="color:#ae81ff">335</span>
</code></pre></div><p>可以使用 <code>-i</code> 参数调整输出间隔。</p>
<h2 id="扫描大-key">
  扫描大 KEY
  <a class="anchor" href="#%e6%89%ab%e6%8f%8f%e5%a4%a7-key">#</a>
</h2>
<p>遇到 Redis 偶然卡顿问题，第一个想到的就是实例中是否存在大 KEY，大 KEY 的内存扩容以及释放都会导致主线程卡顿。
<code>--bigkeys</code> 参数可以很快扫出内存里的大 KEY，使用 <code>-i</code> 参数控制扫描间隔，避免扫描指令导致服务器的 ops 陡增报警。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ./redis-cli --bigkeys -i 0.01
<span style="color:#75715e"># Scanning the entire keyspace to find biggest keys as well as</span>
<span style="color:#75715e"># average sizes per key type.  You can use -i 0.1 to sleep 0.1 sec</span>
<span style="color:#75715e"># per 100 SCAN commands (not usually needed).</span>

<span style="color:#f92672">[</span>00.00%<span style="color:#f92672">]</span> Biggest zset   found so far <span style="color:#e6db74">&#39;hist:aht:main:async_finish:20180425:17&#39;</span> with <span style="color:#ae81ff">1440</span> members
<span style="color:#f92672">[</span>00.00%<span style="color:#f92672">]</span> Biggest zset   found so far <span style="color:#e6db74">&#39;hist:qps:async:authorize:20170311:27&#39;</span> with <span style="color:#ae81ff">2465</span> members
<span style="color:#f92672">[</span>00.00%<span style="color:#f92672">]</span> Biggest hash   found so far <span style="color:#e6db74">&#39;job:counters:6ya9ypu6ckcl&#39;</span> with <span style="color:#ae81ff">3</span> fields
<span style="color:#f92672">[</span>00.01%<span style="color:#f92672">]</span> Biggest string found so far <span style="color:#e6db74">&#39;rt:aht:main:device_online:68:{-4}&#39;</span> with <span style="color:#ae81ff">4</span> bytes
<span style="color:#f92672">[</span>00.01%<span style="color:#f92672">]</span> Biggest zset   found so far <span style="color:#e6db74">&#39;machine:load:20180709&#39;</span> with <span style="color:#ae81ff">2879</span> members
<span style="color:#f92672">[</span>00.02%<span style="color:#f92672">]</span> Biggest string found so far <span style="color:#e6db74">&#39;6y6fze8kj7cy:{-7}&#39;</span> with <span style="color:#ae81ff">90</span> bytes
</code></pre></div><p>redis-cli 对于每一种对象类型都会记录长度最大的 KEY，对于每一种对象类型，刷新一次最高记录就会立即输出一次。它能保证输出长度
为 Top1 的 KEY，但是 Top2、Top3 等 KEY 是无法保证可以扫描出来的。一般的处理方法是多扫描几次，或者是消灭了 Top1 的 KEY 之后再扫
描确认还有没有次大的 KEY。</p>
<h2 id="采样服务器指令">
  采样服务器指令
  <a class="anchor" href="#%e9%87%87%e6%a0%b7%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%8c%87%e4%bb%a4">#</a>
</h2>
<p>现在线上有一台 Redis 服务器的 OPS 太高，有很多业务模块都在使用这个 Redis，如何才能判断出来是哪个业务导致了 OPS 异常的高。这
时可以对线上服务器的指令进行采样，观察采样的指令大致就可以分析出 OPS 占比高的业务点。这时就要使用 monitor 指令，它会将服务器瞬间执行的指令全
部显示出来。不过使用的时候要注意即使使用 ctrl+c 中断，否则你的显示器会噼里啪啦太多的指令瞬间让你眼花缭乱。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ redis-cli --host 192.168.x.x --port <span style="color:#ae81ff">6379</span> monitor
1539853410.458483 <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> 10.100.90.62:34365<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET&#34;</span> <span style="color:#e6db74">&#34;6yax3eb6etq8:{-7}&#34;</span>
1539853410.459212 <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> 10.100.90.61:56659<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;PFADD&#34;</span> <span style="color:#e6db74">&#34;growth:dau:20181018&#34;</span> <span style="color:#e6db74">&#34;2klxkimass8w&#34;</span>
1539853410.462938 <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> 10.100.90.62:20681<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET&#34;</span> <span style="color:#e6db74">&#34;6yax3eb6etq8:{-7}&#34;</span>
1539853410.467231 <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> 10.100.90.61:40277<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;PFADD&#34;</span> <span style="color:#e6db74">&#34;growth:dau:20181018&#34;</span> <span style="color:#e6db74">&#34;2kei0to86ps1&#34;</span>
1539853410.470319 <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> 10.100.90.62:34365<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET&#34;</span> <span style="color:#e6db74">&#34;6yax3eb6etq8:{-7}&#34;</span>
1539853410.473927 <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> 10.100.90.61:58128<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET&#34;</span> <span style="color:#e6db74">&#34;6yax3eb6etq8:{-7}&#34;</span>
1539853410.475712 <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> 10.100.90.61:40277<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;PFADD&#34;</span> <span style="color:#e6db74">&#34;growth:dau:20181018&#34;</span> <span style="color:#e6db74">&#34;2km8sqhlefpc&#34;</span>
1539853410.477053 <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span> 10.100.90.62:61292<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET&#34;</span> <span style="color:#e6db74">&#34;6yax3eb6etq8:{-7}&#34;</span>
</code></pre></div><h2 id="诊断服务器时延">
  诊断服务器时延
  <a class="anchor" href="#%e8%af%8a%e6%96%ad%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%97%b6%e5%bb%b6">#</a>
</h2>
<p>平时诊断两台机器的时延一般是使用 Unix 的 ping 指令。Redis 也提供了时延诊断指令，不过它的原理不太一样，它是诊断当前机器和 Redis 服务
器之间的指令(PING 指令)时延，它不仅仅是物理网络的时延，还和当前的 Redis 主线程是否忙碌有关。如果你发现 Unix 的 ping 指令时延很小，
而 Redis 的时延很大，那说明 Redis 服务器在执行指令时有微弱卡顿。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ redis-cli --host 192.168.x.x --port <span style="color:#ae81ff">6379</span> --latency
min: 0, max: 5, avg: 0.08 <span style="color:#f92672">(</span><span style="color:#ae81ff">305</span> samples<span style="color:#f92672">)</span>
</code></pre></div><p>时延单位是 ms。redis-cli 还能显示时延的分布情况，而且是图形化输出。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ redis-cli --latency-dist
</code></pre></div><h2 id="远程-rdb-备份">
  远程 rdb 备份
  <a class="anchor" href="#%e8%bf%9c%e7%a8%8b-rdb-%e5%a4%87%e4%bb%bd">#</a>
</h2>
<p>执行下面的命令就可以将远程的 Redis 实例备份到本地机器，远程服务器会执行一次 bgsave 操作，然后将 rdb 文件传输到客户端。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ./redis-cli --host 192.168.x.x --port <span style="color:#ae81ff">6379</span> --rdb ./user.rdb
SYNC sent to master, writing <span style="color:#ae81ff">2501265095</span> bytes to <span style="color:#e6db74">&#39;./user.rdb&#39;</span>
Transfer finished with success.
</code></pre></div><h2 id="模拟从库">
  模拟从库
  <a class="anchor" href="#%e6%a8%a1%e6%8b%9f%e4%bb%8e%e5%ba%93">#</a>
</h2>
<p>如果你想观察主从服务器之间都同步了那些数据，可以使用 redis-cli 模拟从库。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ./redis-cli --host 192.168.x.x --port <span style="color:#ae81ff">6379</span> --slave
SYNC with master, discarding <span style="color:#ae81ff">51778306</span> bytes of bulk transfer...
SYNC <span style="color:#66d9ef">done</span>. Logging commands from master.
...
</code></pre></div><p>从库连上主库的第一件事是全量同步，所以看到上面的指令卡顿这很正常，待首次全量同步完成后，就会输出增量的 aof 日志。</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">



  <div><a class="flex align-center" href="https://github.com/shipengqi/db-learn/commit/391abafbb55e9e09f274b9823c6b411133314e4f" title='Last modified by shipengqi | June 17, 2020' target="_blank" rel="noopener">
      <img src="/db-learn/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>June 17, 2020</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/shipengqi/db-learn/edit/master/content//docs/redis/27_skills.md" target="_blank" rel="noopener">
      <img src="/db-learn/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#直接模式">直接模式</a></li>
    <li><a href="#批量执行命令">批量执行命令</a></li>
    <li><a href="#set-多行字符串">set 多行字符串</a></li>
    <li><a href="#重复执行指令">重复执行指令</a></li>
    <li><a href="#监控服务器状态">监控服务器状态</a></li>
    <li><a href="#扫描大-key">扫描大 KEY</a></li>
    <li><a href="#采样服务器指令">采样服务器指令</a></li>
    <li><a href="#诊断服务器时延">诊断服务器时延</a></li>
    <li><a href="#远程-rdb-备份">远程 rdb 备份</a></li>
    <li><a href="#模拟从库">模拟从库</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












