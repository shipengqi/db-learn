---
title: 数据目录
---

`SHOW VARIABLES LIKE 'datadir';` 可以查看数据目录的路径。

**每个数据库都对应数据目录下的一个子目录，或者说对应一个文件夹**。

`CREATE DATABASE 数据库名` 创建一个数据库：

1. 数据目录下会创建一个数据库同名的子目录。
2. 同名子目录下会创建一个 `db.obt` 文件包含数据库的各种信息。

## 表在文件系统中的表示

数据其实都是以记录的形式插入到表中的，每个表的信息其实可以分为两种：

1. 表结构的定义，表的名称，列信息，索引等，子目录下对应的文件：`表名.frm`
2. 表中的数据

## 数据是如何存储的

- InnoDB 其实是使用页为基本单位来管理存储空间的，默认的页大小为 16KB。
- 对于 InnoDB 存储引擎来说，每个索引都对应着一棵 B+ 树，该 B +树的每个节点都是一个数据页，数据页之间不必要是物理连续的，因为数据页之间有双向链表来维护着这些页的顺序。
- InnoDB 的聚簇索引的叶子节点存储了完整的用户记录，也就是所谓的**索引即数据，数据即索引**。

为了更好的管理这些页，有了个**表空间**或者**文件空间**（table space 或者 file space）的概念。表空间是一个抽象的概念，它可以对应文件系统上一个或多个真实文件（不同表空间对应的文件数量可能不同）。

每一个表空间可以被划分为很多很多很多个页，我们的表数据就存放在某个表空间下的某些页里。

### 系统表空间

默认情况下，InnoDB会 在数据目录下创建一个名为 `ibdata1`，大小为 `12M` 的文件，这个文件就是对应的**系统表空间**在文件系统上的表示。

这个文件是**自扩展文件**，也就是当不够用的时候它会自己增加文件大小。

可以在配置文件中修改系统表空间文件的文件名和大小：

```cnf
[server]
innodb_data_file_path=data1:512M;data2:512M:autoextend
```

创建这两个 512M 大小的文件作为系统表空间，其中的 `autoextend` 表明这两个文件如果不够用会自动扩展 `data2` 文件的大小。

启动参数 `innodb_data_file_path` 和 `innodb_data_home_dir` 可以修改该文件的路径。

系统表空间只有一份。

### 独立表空间

InnoDB 会为每一个表建立一个**独立表空间**。在该表所属数据库对应的子目录下创建一个表示该独立表空间的文件，文件名和表名相同，扩展名为 `.ibd`。

也可以自己指定使用系统表空间还是独立表空间来存储数据，使用参数 `innodb_file_per_table` 控制：

```cnf
[server]
innodb_file_per_table=0
```

`innodb_file_per_table` 的值为 `0` 时，代表使用系统表空间。只对新建的表起作用，对于已经分配了表空间的表并不起作用。

一些不同类型的表空间，比如**通用表空间**（general tablespace）、**undo 表空间**（undo tablespace）、临时表空间（temporary tablespace）等。
